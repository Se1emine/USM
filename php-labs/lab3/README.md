# PHP Лабораторная работа №3 — Массивы, перебор и файловая система

Проект содержит две самостоятельные мини‑задачи на PHP:

- `ex1/` — система управления банковскими транзакциями (массивы, функции, сортировки, рендеринг таблиц).
- `ex2/` — простая галерея изображений (сканирование директории, фильтрация файлов по расширениям и вывод сетки изображений).

## 1) Инструкции по запуску проекта

Требования:
- PHP 7.1+ (используются строгие типы и возвращаемые типы вроде `?array`).
- Любой современный браузер.

Вариант A. Встроенный сервер PHP (рекомендуется для локального запуска):
- Запуск `ex1/`:
  1. Откройте терминал в корне проекта.
  2. Выполните команду:
     ```bash
     php -S localhost:8001 -t ex1
     ```
  3. Откройте в браузере: http://localhost:8001

- Запуск `ex2/`:
  1. Откройте второй терминал (или остановите предыдущий сервер).
  2. Выполните команду:
     ```bash
     php -S localhost:8002 -t ex2
     ```
  3. Откройте в браузере: http://localhost:8002

Вариант B. Любой HTTP‑сервер (Apache/Nginx):
- Установите корнем сайта папку `ex1/` или `ex2/` в зависимости от задачи.
- Убедитесь, что сервер отдаёт статические файлы (CSS, изображения) и интерпретирует `.php`.

Примечание для Windows/PowerShell:
- Аналогичные команды запуска выполняются так же, например:
  ```powershell
  php -S localhost:8001 -t ex1
  php -S localhost:8002 -t ex2
  ```

## 2) Описание лабораторной работы

- `ex1/` демонстрирует работу с массивами ассоциативных данных (транзакции), реализацию прикладных функций:
  - суммирование значений (`calculateTotalAmount()`),
  - поиск по описанию без учёта регистра (`findTransactionByDescription()`),
  - поиск по идентификатору разными способами (`findTransactionById()`, `findTransactionByIdFilter()`),
  - вычисление количества дней с даты транзакции (`daysSinceTransaction()`),
  - добавление новой записи (`addTransaction()`),
  - сортировки по дате и сумме (`sortTransactionsByDate()`, `sortTransactionsByAmount()`).
  Результаты функций визуализируются в HTML‑таблицах.

- `ex2/` демонстрирует работу с файловой системой:
  - создание директории при её отсутствии,
  - сканирование директории `image/`,
  - фильтрацию изображений по расширениям (`jpg`, `jpeg`, `png`, `gif`, `webp`),
  - отображение адаптивной галереи с подписями и эффектами наведения.

## 3) Краткая документация к проекту

Структура проекта:
- `ex1/index.php` — исходный код логики работы с транзакциями и HTML‑вывод.
- `ex1/styles.css` — стили таблиц, секций и текста.
- `ex2/index.php` — логика сканирования директории и формирование галереи.
- `ex2/styles.css` — стили галереи, анимации, адаптивность.
- `ex2/image/` — директория для изображений (можно добавлять свои файлы).

Ключевые функции `ex1/index.php`:
- `calculateTotalAmount(array $transactions): float` — суммирует поле `amount`.
- `findTransactionByDescription(string $descriptionPart): array` — регистронезависимый поиск по `description`.
- `findTransactionById(int $id): ?array` — линейный поиск по `id`.
- `findTransactionByIdFilter(int $id): ?array` — поиск с использованием `array_filter` и `array_values`.
- `daysSinceTransaction(string $date): int` — разница в днях между `date` и текущей датой (`DateTime::diff`).
- `addTransaction(int $id, string $date, float $amount, string $description, string $merchant): void` — добавляет новую транзакцию в массив.
- `sortTransactionsByDate(array &$transactions): void` — сортировка по дате по возрастанию (`usort`, `strtotime`).
- `sortTransactionsByAmount(array &$transactions): void` — сортировка по сумме по убыванию.
- `displayTransactions(array $transactions): void` — отрисовка HTML‑таблицы.

Ключевая логика `ex2/index.php`:
- Гарантирует наличие директории `image/` (`mkdir` c `0755`, `recursive`),
- Получает список файлов (`scandir`) и фильтрует по расширениям,
- Формирует карточки галереи с `alt` и `loading="lazy"`.

## 4) Примеры использования и иллюстрации

Фрагменты кода из `ex1/index.php`:

- Сумма всех транзакций:
  ```php
  $total = calculateTotalAmount($transactions);
  echo number_format($total, 2);
  ```

- Поиск по описанию (без учёта регистра):
  ```php
  $searchResults = findTransactionByDescription("payment");
  echo count($searchResults);
  ```

- Поиск по ID (два подхода):
  ```php
  $found = findTransactionById(3);
  $found2 = findTransactionByIdFilter(3);
  ```

- Сортировка копии массива по дате:
  ```php
  $copy = $transactions;
  sortTransactionsByDate($copy);
  displayTransactions($copy);
  ```

Фрагменты кода из `ex2/index.php`:

- Создание директории и сбор изображений:
  ```php
  $dir = 'image/';
  if (!is_dir($dir)) {
      mkdir($dir, 0755, true);
  }

  $files = scandir($dir);
  $imageFiles = [];
  foreach ($files as $file) {
      if ($file !== '.' && $file !== '..') {
          $ext = strtolower(pathinfo($file, PATHINFO_EXTENSION));
          if (in_array($ext, ['jpg','jpeg','png','gif','webp'])) {
              $imageFiles[] = $file;
          }
      }
  }
  ```

Иллюстрации/скриншоты (опционально):
- Сохраните скриншоты в корень проекта или рядом с README и вставьте ссылки:
  - `![Транзакции](docs/screens/ex1-table.png)`
  - `![Галерея](docs/screens/ex2-gallery.png)`

## 5) Ответы на контрольные вопросы

- Что такое массивы в PHP?
  Массив — это упорядоченная структура данных, позволяющая хранить набор значений под одним именем. В PHP массивы могут быть индексными (ключи — числа) и ассоциативными (ключи — строки). Они динамические: размер и состав можно менять на лету. В проекте `ex1/` используется ассоциативный массив транзакций, где каждую запись описывают поля `id`, `date`, `amount`, `description`, `merchant`.

- Каким образом можно создать массив в PHP?
  Примеры:
  ```php
  // Пустой массив
  $a = [];

  // Индексный массив
  $numbers = [10, 20, 30];

  // Ассоциативный массив
  $user = [
      'name' => 'Ivan',
      'age'  => 25,
  ];

  // Массив массивов (как в ex1)
  $transactions = [
      ['id' => 1, 'date' => '2024-01-01', 'amount' => 100.0, 'description' => '...', 'merchant' => '...'],
      // ...
  ];
  ```

- Для чего используется цикл foreach?
  `foreach` удобен для перебора элементов массива без контроля индекса вручную. Он читабельнее и безопаснее при итерировании коллекций. В `ex1/` он применяется для суммирования и поиска по массиву транзакций, а в `ex2/` — для перебора файлов директории после `scandir()`.

## 6) Список использованных источников

- Документация PHP:
  - https://www.php.net/manual/ru/language.types.array.php
  - https://www.php.net/manual/ru/control-structures.foreach.php
  - https://www.php.net/scandir
  - https://www.php.net/pathinfo
  - https://www.php.net/usort
  - https://www.php.net/stripos
  - https://www.php.net/datetime

## 7) Дополнительные важные аспекты

- Безопасность вывода: при выводе строк в HTML используется `htmlspecialchars()` (см. `displayTransactions()` и вывод атрибутов в галерее) — это предотвращает XSS при работе с произвольными данными.
- Производительность: сортировки и поиски линейные и подойдут для учебных объёмов данных. Для больших данных логично использовать БД и индексацию.
- Локализация: интерфейсы ориентированы на RU; при необходимости можно вынести строки в отдельные константы/файлы.
- Адаптивность: CSS в обоих упражнениях содержит медиа‑правила для удобного отображения на мобильных устройствах.
- Расширяемость `ex2/`: при желании можно добавить загрузку изображений через форму, валидацию форматов и предпросмотр.
